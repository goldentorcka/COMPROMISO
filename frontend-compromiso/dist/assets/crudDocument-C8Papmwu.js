import{r as t,j as e,c as _,S as d,b as O}from"./index-CXkMEiwO.js";import{u as T,w as V,M as L,C as $}from"./Datatable--g9hJFft.js";const G=({documento:s,handleSubmit:B,responsables:j=[],procedimientos:M=[]})=>{const[u,E]=t.useState(null),[p,l]=t.useState(""),[b,y]=t.useState(""),[N,S]=t.useState(""),[w,f]=t.useState("Formato"),[m,C]=t.useState(""),[x,F]=t.useState(""),[g,A]=t.useState(""),[R,k]=t.useState("Activo"),[D,I]=t.useState(""),[a,z]=t.useState({});t.useEffect(()=>{s?(E(s.id||null),l(s.nombre_documento||""),y(s.nombre_documento_magnetico||""),S(s.nombre_documento_visualizacion||""),f(s.tipo_documento||"Formato"),C(s.codigo||""),F(s.id_procedimiento||""),A(s.id_responsable||""),k(s.estado||"Activo"),I(s.version||"")):q()},[s]);const o=()=>{const r={};return(!m||m.length<3)&&(r.codigo="El código del documento es obligatorio y debe tener al menos 3 caracteres."),p||(r.nombreDocumento="El nombre del documento es obligatorio."),x||(r.idProcedimiento="Debes seleccionar un procedimiento."),g||(r.idResponsable="Debes seleccionar un responsable."),b||(r.nombreDocumentoMagnetico="Debes subir un archivo Excel."),D||(r.version="La versión del documento es obligatoria."),z(r),Object.keys(r).length===0},i=r=>{const v=r.target.files[0];if(v){const c=v.name;y(c),l(c),S(c.replace(/\.[^/.]+$/,"")+".pdf")}},n=r=>{const{name:v,value:c}=r.target;switch(v){case"codigo":C(c);break;case"nombreDocumento":l(c);break;case"idProcedimiento":F(c);break;case"idResponsable":A(c);break;case"tipoDocumento":f(c);break;case"estado":k(c);break;case"version":I(c);break}},h=()=>{const r=[{id_documento:u,nombre_documento:p,nombre_documento_magnetico:b,nombre_documento_visualizacion:N,tipo_documento:w,codigo:m,id_procedimiento:x,id_responsable:g,estado:R,version:D,createdAt:new Date,updatedAt:new Date}],v=T.json_to_sheet(r),c=T.book_new();T.book_append_sheet(c,v,"Documentos"),V(c,`${b}.xlsx`)},P=r=>{r.preventDefault(),o()&&(B({id_documento:u,nombre_documento:p,nombre_documento_magnetico:b,nombre_documento_visualizacion:N,tipo_documento:w,codigo:m,id_procedimiento:x,id_responsable:g,estado:R,version:D,createdAt:new Date,updatedAt:new Date}),h(),q())},q=()=>{E(null),l(""),y(""),S(""),f("Formato"),C(""),F(""),A(""),k("Activo"),I(""),z({})};return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"codigo",children:"Código del Documento:"}),e.jsx("input",{type:"text",name:"codigo",id:"codigo",value:m,onChange:n,required:!0,"aria-describedby":"codigoError"}),a.codigo&&e.jsx("span",{id:"codigoError",className:"error",children:a.codigo})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nombreDocumento",children:"Nombre del Documento:"}),e.jsx("input",{type:"text",name:"nombreDocumento",id:"nombreDocumento",value:p,onChange:n,required:!0,"aria-describedby":"nombreDocumentoError"}),a.nombreDocumento&&e.jsx("span",{id:"nombreDocumentoError",className:"error",children:a.nombreDocumento})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nombreDocumentoMagnetico",children:"Subir Documento Excel:"}),e.jsx("input",{type:"file",name:"nombreDocumentoMagnetico",id:"nombreDocumentoMagnetico",accept:".xlsx, .xls",onChange:i,required:!0,"aria-describedby":"nombreDocumentoMagneticoError"}),a.nombreDocumentoMagnetico&&e.jsx("span",{id:"nombreDocumentoMagneticoError",className:"error",children:a.nombreDocumentoMagnetico})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"idProcedimiento",children:"Procedimiento:"}),e.jsxs("select",{name:"idProcedimiento",id:"idProcedimiento",value:x,onChange:n,required:!0,"aria-describedby":"idProcedimientoError",children:[e.jsx("option",{value:"",children:"Selecciona un procedimiento"}),M.map(r=>e.jsx("option",{value:r.id_procedimiento,children:r.nombre_procedimiento},r.id_procedimiento))]}),a.idProcedimiento&&e.jsx("span",{id:"idProcedimientoError",className:"error",children:a.idProcedimiento})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"idResponsable",children:"Responsable:"}),e.jsxs("select",{name:"idResponsable",id:"idResponsable",value:g,onChange:n,required:!0,"aria-describedby":"idResponsableError",children:[e.jsx("option",{value:"",children:"Selecciona un responsable"}),j.map(r=>e.jsx("option",{value:r.id_responsable,children:r.nombre_responsable},r.id_responsable))]}),a.idResponsable&&e.jsx("span",{id:"idResponsableError",className:"error",children:a.idResponsable})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tipoDocumento",children:"Tipo de Documento:"}),e.jsxs("select",{name:"tipoDocumento",id:"tipoDocumento",value:w,onChange:n,required:!0,children:[e.jsx("option",{value:"Formato",children:"Formato"}),e.jsx("option",{value:"Informe",children:"Informe"}),e.jsx("option",{value:"Otros",children:"Otros"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"estado",children:"Estado:"}),e.jsxs("select",{name:"estado",id:"estado",value:R,onChange:n,children:[e.jsx("option",{value:"Activo",children:"Activo"}),e.jsx("option",{value:"Inactivo",children:"Inactivo"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"version",children:"Versión:"}),e.jsx("input",{type:"text",name:"version",id:"version",value:D,onChange:n,required:!0,"aria-describedby":"versionError"}),a.version&&e.jsx("span",{id:"versionError",className:"error",children:a.version})]}),e.jsx("button",{type:"submit",children:"Guardar Documento"})]})})},J=()=>{const[s,B]=t.useState([]),[j,M]=t.useState(null),[u,E]=t.useState("Enviar"),[p,l]=t.useState(!1),[b,y]=t.useState([]),[N,S]=t.useState([]),[w,f]=t.useState(!0);t.useEffect(()=>{m(),C(),x()},[]);const m=async()=>{try{const o=await _.get("/api/documentos");B(o.data)}catch(o){console.error("Error al obtener los documentos:",o),d.fire("Error","No se pudieron obtener los documentos","error")}},C=async()=>{try{const o=await _.get("/api/responsables");y(o.data)}catch(o){console.error("Error al obtener los responsables:",o),d.fire("Error","No se pudieron obtener los responsables","error")}},x=async()=>{try{const o=await _.get("/api/procedimientos");S(o.data)}catch(o){console.error("Error al obtener los procedimientos:",o),d.fire("Error","No se pudieron obtener los procedimientos","error")}},F=async(o,i)=>{o.preventDefault();const n=A(i);if(n){d.fire("Error",n,"error");return}try{if(u==="Enviar"){const h=i.nombre_documento.replace(/\s/g,"_")+".pdf",P={...i,nombre_documento_magnetico:h};await _.post("/api/documentos",P),d.fire("Agregado!","El documento ha sido agregado.","success")}else u==="Actualizar"&&j&&(await _.put(`/api/documentos/${j.id_documento}`,i),d.fire("Actualizado!","El documento ha sido actualizado.","success"));g(),l(!1),m()}catch(h){console.error("Error al enviar el formulario:",h),d.fire("Error","No se pudo guardar el documento","error")}},g=()=>{M(null),E("Enviar"),f(!0)},A=o=>{const{codigo:i,nombre_documento:n,id_responsable:h,id_procedimiento:P}=o;return!i||i.trim()===""?"El código del documento es obligatorio.":!n||n.trim()===""?"El nombre del documento es obligatorio.":h?P?null:"El ID del procedimiento es obligatorio.":"El ID del responsable es obligatorio."},R=o=>{const i=b.find(n=>n.id_responsable===o);return i?i.nombre_responsable:"Desconocido"},k=o=>{const i=N.find(n=>n.id_procedimiento===o);return i?i.nombre_procedimiento:"Desconocido"},D=[{field:"codigo",header:"Código",width:"10%"},{field:"nombre_documento",header:"Nombre",width:"15%"},{field:"nombre_documento_magnetico",header:"Nombre Magnético",width:"15%"},{field:"id_responsable",header:"Responsable",width:"15%"},{field:"id_procedimiento",header:"Procedimiento",width:"15%"}],I=s.map(o=>({...o,id_responsable:R(o.id_responsable),id_procedimiento:k(o.id_procedimiento)})),a=o=>{M(o),E("Actualizar"),l(!0)},z=async o=>{if((await d.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminarlo!"})).isConfirmed)try{(await _.delete(`/api/documentos/${o.id_documento}`)).status===204?(d.fire("Eliminado!","El documento ha sido eliminado.","success"),m()):d.fire("Error","No se pudo eliminar el documento","error")}catch(n){console.error("Error al eliminar el documento:",n),d.fire("Error","No se pudo eliminar el documento","error")}};return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#f4f4f4"},children:[e.jsx(O,{}),e.jsxs("div",{style:{flex:1,padding:"20px",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[e.jsx("h1",{style:{marginBottom:"20px",fontSize:"2rem",fontFamily:"Georgia, serif",textTransform:"uppercase"},children:"Gestión de Documentos"}),e.jsxs("div",{style:{width:"100%",maxWidth:"1200px",display:"flex",flexDirection:"column",alignItems:"center",gap:"20px"},children:[e.jsx("button",{style:{display:"flex",alignItems:"center",padding:"10px 20px",fontSize:"1rem",backgroundColor:"#4caf50",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",marginBottom:"20px"},onClick:()=>{g(),l(!0)},children:"Añadir Documento"}),p&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999}}),e.jsx(L,{isOpen:p,onClose:()=>{l(!1),f(!0)},title:u==="Enviar"?"Agregar Documento":"Actualizar Documento",children:e.jsx(G,{documento:j,handleSubmit:F,buttonForm:u,responsables:b,procedimientos:N})}),w&&e.jsx($,{data:I,columns:D,onEdit:a,onDelete:z,searchField:"nombre_documento",exportFields:["codigo","nombre_documento","nombre_documento_magnetico","id_responsable","id_procedimiento"]})]})]})]})};export{J as default};
